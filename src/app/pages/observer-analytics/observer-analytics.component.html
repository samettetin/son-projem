<section class="hero">
  <div class="container">
    <h1 class="title">Gözlemci Analitiği</h1>
    <p class="subtitle">Kendi organizasyonundaki öğrencilerin performans özeti</p>
  </div>
</section>

<div class="container stack" style="margin-top:16px">
  <div class="card">
    <div class="row" style="justify-content:space-between; align-items:center">
      <div class="muted">Toplam Öğrenci: <strong>{{ rows.length }}</strong></div>
      <div class="row" style="gap:8px">
        <button class="btn ghost" (click)="sort('avgProgress')">Sıralama: İlerleme</button>
        <button class="btn ghost" (click)="sort('totalMinutes')">Sıralama: Süre</button>
        <button class="btn ghost" (click)="sort('enrollCount')">Sıralama: Kurs Sayısı</button>
      </div>
    </div>
  </div>

  <div class="card table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>Öğrenci</th>
          <th>Kurs</th>
          <th>Ortalama İlerleme</th>
          <th>Toplam Süre (dk)</th>
          <th>Son Aktivite</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of rows">
          <td>
            <div class="row">
              <div class="avatar">{{ (r.user.fullName||'?').slice(0,1) }}</div>
              <div>
                <div class="name">{{ r.user.fullName }}</div>
                <div class="muted">{{ r.user.department || '—' }}</div>
              </div>
            </div>
          </td>
          <td>{{ r.enrollCount }}</td>
          <td>
            <div class="bar">
              <div class="fill" [style.width.%]="r.avgProgress"></div>
              <span>{{ r.avgProgress }}%</span>
            </div>
          </td>
          <td>{{ r.totalMinutes || 0 }}</td>
          <td>{{ r.lastActive ? (r.lastActive | date:'short') : '—' }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
